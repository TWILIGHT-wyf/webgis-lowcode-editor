# 2025-11-20 å¼€å‘æ—¥å¿—

## ä¸»é¢˜ 1ï¼šå›¾è¡¨ç»„ä»¶æ‰©å±• - é¥¼å›¾ã€ç¯å½¢å›¾ã€æ•£ç‚¹å›¾

### å®Œæˆå·¥ä½œ

#### 1. æ–°å¢ä¸‰ä¸ªå›¾è¡¨ç»„ä»¶

**é¥¼å›¾ç»„ä»¶ (pieChart)**

- æ–‡ä»¶è·¯å¾„ï¼š`src/customComponents/chart/pieChart/pieChart.vue`
- æ ¸å¿ƒåŠŸèƒ½ï¼š
  - æ”¯æŒæ•°æ®æºé…ç½®ï¼ˆdataPathã€labelsPathï¼‰
  - è·¯å¾„è§£æå·¥å…·å‡½æ•°ï¼ˆgetValueByPathï¼‰æ”¯æŒåµŒå¥—æ•°æ®æå–
  - æ‰‹åŠ¨è¾“å…¥æ•°æ®ï¼ˆé€—å·åˆ†éš”æ ¼å¼ï¼‰ä½œä¸ºå¤‡ç”¨
  - å®Œæ•´çš„æ ·å¼é…ç½®ï¼šæ ‡é¢˜ã€åŠå¾„ã€ä¸­å¿ƒä½ç½®ã€æ ‡ç­¾æ ¼å¼ã€å›¾ä¾‹é…ç½®
  - å“åº”å¼æ›´æ–°ï¼šç›‘å¬ propsã€dataSourceã€remoteData å˜åŒ–

**ç¯å½¢å›¾ç»„ä»¶ (doughnutChart)**

- æ–‡ä»¶è·¯å¾„ï¼š`src/customComponents/chart/doughnutChart/doughnutChart.vue`
- æ ¸å¿ƒåŠŸèƒ½ï¼š
  - åŒåŠå¾„é…ç½®ï¼ˆinnerRadiusã€outerRadiusï¼‰å®ç°ç¯å½¢æ•ˆæœ
  - è¾¹æ¡†æ ·å¼ï¼šåœ†è§’ã€é¢œè‰²ã€å®½åº¦
  - æ”¯æŒæ•°æ®æºå’Œæ‰‹åŠ¨è¾“å…¥ä¸¤ç§æ–¹å¼
  - æ ‡ç­¾çº¿é…ç½®ï¼ˆshowLabelLineï¼‰
  - å¼ºè°ƒæ ·å¼ï¼ˆemphasisï¼‰å¢å¼ºäº¤äº’æ•ˆæœ

**æ•£ç‚¹å›¾ç»„ä»¶ (scatterChart)**

- æ–‡ä»¶è·¯å¾„ï¼š`src/customComponents/chart/scatterChart/scatterChart.vue`
- æ ¸å¿ƒåŠŸèƒ½ï¼š
  - æ”¯æŒäºŒç»´æ•°ç»„æ•°æ®æ ¼å¼ `[[x1, y1], [x2, y2], ...]`
  - æ•°æ®æºè·¯å¾„è§£æï¼ˆdataPathï¼‰
  - ç‚¹æ ·å¼é…ç½®ï¼šå¤§å°ã€é¢œè‰²ã€é€æ˜åº¦
  - åæ ‡è½´é…ç½®ï¼šåç§°ã€åˆ†éš”çº¿æ˜¾ç¤º
  - ç½‘æ ¼å¸ƒå±€é…ç½®ï¼šä¸Šä¸‹å·¦å³è¾¹è·

#### 2. ç»„ä»¶æ³¨å†Œä¸é…ç½®

**æ³¨å†Œè¡¨æ›´æ–°** (`src/customComponents/registry.ts`)

```typescript
import pieChart from './chart/pieChart/pieChart.vue'
import doughnutChart from './chart/doughnutChart/doughnutChart.vue'
import scatterChart from './chart/scatterChart/scatterChart.vue'

export const componentRegistry: Record<string, Component> = {
  // ...existing components
  pieChart: pieChart,
  doughnutChart: doughnutChart,
  scatterChart: scatterChart,
}
```

**é»˜è®¤é…ç½®** (`src/stores/component.ts`)

- pieChart é»˜è®¤é…ç½®ï¼š
  - 5ä¸ªåˆ†ç±»çš„ç¤ºä¾‹æ•°æ®
  - 60% åŠå¾„ï¼Œå±…ä¸­æ˜¾ç¤º
  - æ˜¾ç¤ºæ ‡ç­¾å’Œå›¾ä¾‹

- doughnutChart é»˜è®¤é…ç½®ï¼š
  - 5ä¸ªè®¿é—®æ¥æºç¤ºä¾‹æ•°æ®
  - 40%-70% åŒåŠå¾„ç¯å½¢
  - 10px åœ†è§’ï¼Œç™½è‰²è¾¹æ¡†

- scatterChart é»˜è®¤é…ç½®ï¼š
  - 10ä¸ªæ•£ç‚¹çš„äºŒç»´æ•°ç»„æ•°æ®
  - ç‚¹å¤§å° 10ï¼Œè“è‰²åŠé€æ˜
  - æ˜¾ç¤ºåæ ‡è½´åˆ†éš”çº¿

**æ•°æ®æºç±»å‹æ‰©å±•**

```typescript
export interface DataSource {
  // ...existing fields
  labelsPath?: string // ç”¨äºé¥¼å›¾/ç¯å½¢å›¾çš„æ ‡ç­¾è·¯å¾„
}
```

#### 3. å±æ€§é¢æ¿é…ç½®

**æ•°æ®æºé…ç½®** (`src/components/siderBar/properties/properties.ts`)

- pieChart & doughnutChartï¼š
  - å¯ç”¨å¼€å…³
  - API åœ°å€ã€è¯·æ±‚æ–¹æ³•
  - è‡ªåŠ¨åˆ·æ–°é—´éš”
  - æ•°æ®å€¼è·¯å¾„ï¼ˆdataPathï¼‰
  - æ ‡ç­¾è·¯å¾„ï¼ˆlabelsPathï¼‰
  - è¯·æ±‚å¤´é…ç½®

- scatterChartï¼š
  - æ•°æ®è·¯å¾„ï¼ˆdataPathï¼‰ç”¨äºäºŒç»´æ•°ç»„
  - å…¶ä»–é…ç½®åŒä¸Š

**ç»„ä»¶å±æ€§é…ç½®**

- pieChartï¼š16 ä¸ªé…ç½®é¡¹ï¼ˆæ ‡é¢˜ã€æ•°æ®ã€åŠå¾„ã€æ ‡ç­¾ã€å›¾ä¾‹ç­‰ï¼‰
- doughnutChartï¼š20 ä¸ªé…ç½®é¡¹ï¼ˆå¢åŠ è¾¹æ¡†ã€å†…å¤–åŠå¾„ã€æ ‡ç­¾çº¿ç­‰ï¼‰
- scatterChartï¼š20 ä¸ªé…ç½®é¡¹ï¼ˆç‚¹æ ·å¼ã€åæ ‡è½´ã€ç½‘æ ¼å¸ƒå±€ç­‰ï¼‰

#### 4. ç»„ä»¶é¢æ¿é›†æˆ

**æ›´æ–°** (`src/components/componentBar.vue`)

- åœ¨"å›¾è¡¨"åˆ†ç±»ä¸­æ·»åŠ ä¸‰ä¸ªæ–°ç»„ä»¶
- pieChartï¼š280x280 é»˜è®¤å°ºå¯¸
- doughnutChartï¼š280x280 é»˜è®¤å°ºå¯¸
- scatterChartï¼š320x240 é»˜è®¤å°ºå¯¸
- æ ‡ç­¾å’Œæ ‡ç­¾ï¼ˆtagsï¼‰è®¾ç½®å®Œæ•´

#### 5. Mock API æ‰©å±•

**æ–°å¢æµ‹è¯•æ¥å£** (`test/mockServer.mjs`)

1. `/api/chart/pie` - é™æ€é¥¼å›¾æ•°æ®

   ```json
   {
     "data": {
       "values": [335, 310, 234, 135, 148],
       "labels": ["äº§å“A", "äº§å“B", "äº§å“C", "äº§å“D", "äº§å“E"]
     }
   }
   ```

2. `/api/chart/doughnut` - åŠ¨æ€ç¯å½¢å›¾æ•°æ®ï¼ˆéšæœºç”Ÿæˆï¼‰
   - 5ä¸ªè®¿é—®æ¥æºåˆ†ç±»
   - æ¯æ¬¡è¯·æ±‚è¿”å›éšæœºæ•°å€¼
   - åŒ…å«æ—¶é—´æˆ³

3. `/api/chart/scatter` - æ•£ç‚¹å›¾æ•°æ®
   - ç”Ÿæˆ 20 ä¸ªéšæœºæ•£ç‚¹
   - äºŒç»´æ•°ç»„æ ¼å¼ `[[x, y], ...]`

4. `/api/chart/pie-realtime` - å®æ—¶é¥¼å›¾æ•°æ®
   - éšæœºç”Ÿæˆ 5 ä¸ªåˆ†ç±»çš„æ•°å€¼
   - åŒ…å«æ›´æ–°æ—¶é—´

### æŠ€æœ¯äº®ç‚¹

#### 1. æ•°æ®è·¯å¾„è§£æ

```typescript
function getValueByPath(obj: unknown, path: string): unknown {
  if (!path || !obj) return undefined
  try {
    const keys = path.replace(/\[(\d+)\]/g, '.$1').split('.')
    let result: unknown = obj
    for (const key of keys) {
      if (result === null || result === undefined) return undefined
      result = (result as Record<string, unknown>)[key]
    }
    return result
  } catch {
    return undefined
  }
}
```

- æ”¯æŒç‚¹å·è·¯å¾„ï¼š`data.chart.values`
- æ”¯æŒæ•°ç»„ç´¢å¼•ï¼š`items[0].value`
- å®¹é”™å¤„ç†ï¼šè·¯å¾„ä¸å­˜åœ¨æ—¶è¿”å› undefined

#### 2. æ•°æ®ä¼˜å…ˆçº§

```
æ•°æ®æºï¼ˆè¿œç¨‹æ•°æ® + è·¯å¾„æå–ï¼‰ > æ‰‹åŠ¨è¾“å…¥ï¼ˆé€—å·åˆ†éš”æˆ–JSONï¼‰ > é»˜è®¤æ•°æ®
```

#### 3. å“åº”å¼ç›‘å¬

```typescript
watch(
  [() => comp.value?.props, () => comp.value?.dataSource, remoteData],
  () => {
    if (chartInstance) {
      chartInstance.setOption(buildOption(), true)
    }
  },
  { deep: true },
)
```

- æ·±åº¦ç›‘å¬ç»„ä»¶å±æ€§å˜åŒ–
- ç›‘å¬æ•°æ®æºé…ç½®å˜åŒ–
- ç›‘å¬è¿œç¨‹æ•°æ®æ›´æ–°
- è‡ªåŠ¨è§¦å‘å›¾è¡¨é‡ç»˜

#### 4. ç±»å‹å®‰å…¨

- å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- é¿å…ä½¿ç”¨ any ç±»å‹ï¼ˆæ•£ç‚¹å›¾ formatter ä½¿ç”¨ unknown ç±»å‹æ–­è¨€ï¼‰
- ä¸ç°æœ‰ç»„ä»¶ç³»ç»Ÿç±»å‹å®Œå…¨å…¼å®¹

### ä½¿ç”¨ç¤ºä¾‹

**é¥¼å›¾æ•°æ®æºé…ç½®**

1. å¯ç”¨æ•°æ®æº
2. API åœ°å€ï¼š`http://localhost:3001/api/chart/pie`
3. æ•°æ®å€¼è·¯å¾„ï¼š`data.values`
4. æ ‡ç­¾è·¯å¾„ï¼š`data.labels`

**ç¯å½¢å›¾å®æ—¶åˆ·æ–°**

1. API åœ°å€ï¼š`http://localhost:3001/api/chart/doughnut`
2. åˆ·æ–°é—´éš”ï¼š3 ç§’
3. æ•°æ®è‡ªåŠ¨æ›´æ–°ï¼ŒåŠ¨æ€å±•ç¤ºå˜åŒ–

**æ•£ç‚¹å›¾æ•°æ®æ ¼å¼**

- æ‰‹åŠ¨è¾“å…¥ï¼š`[[10, 8.04], [8.07, 6.95], [13, 7.58]]`
- æ•°æ®æºè·¯å¾„ï¼š`data.points`

### æµ‹è¯•æ–¹å¼

```bash
# å¯åŠ¨ mock server
cd test
node mockServer.mjs

# è®¿é—® http://localhost:3001
# æŸ¥çœ‹å®Œæ•´çš„ API æ–‡æ¡£
```

æ–°å¢çš„ API ç«¯ç‚¹ï¼š

- ğŸ“Š `/api/chart/pie` - é¥¼å›¾é™æ€æ•°æ®
- ğŸ“Š `/api/chart/doughnut` - ç¯å½¢å›¾åŠ¨æ€æ•°æ®
- ğŸ“Š `/api/chart/scatter` - æ•£ç‚¹å›¾æ•°æ®
- ğŸ“Š `/api/chart/pie-realtime` - é¥¼å›¾å®æ—¶æ•°æ®

### åç»­æ‰©å±•å»ºè®®

- [ ] é›·è¾¾å›¾ç»„ä»¶ï¼ˆradarChartï¼‰
- [ ] æ¼æ–—å›¾ç»„ä»¶ï¼ˆfunnelChartï¼‰
- [ ] ä»ªè¡¨ç›˜ç»„ä»¶ï¼ˆgaugeChartï¼‰
- [ ] åœ°å›¾ç»„ä»¶ï¼ˆmapChartï¼‰
- [ ] å…³ç³»å›¾ç»„ä»¶ï¼ˆgraphChartï¼‰
- [ ] çƒ­åŠ›å›¾ç»„ä»¶ï¼ˆheatmapChartï¼‰

### æŠ€æœ¯æ”¶è·

1. **ECharts å›¾è¡¨ç±»å‹**ï¼šæŒæ¡é¥¼å›¾ã€ç¯å½¢å›¾ã€æ•£ç‚¹å›¾çš„é…ç½®å’Œä½¿ç”¨
2. **æ•°æ®è·¯å¾„æå–**ï¼šå®ç°çµæ´»çš„åµŒå¥—æ•°æ®è§£æå·¥å…·
3. **æ•°æ®æºä¼˜å…ˆçº§**ï¼šè®¾è®¡åˆç†çš„æ•°æ®æ¥æºä¼˜å…ˆçº§ç­–ç•¥
4. **TypeScript ç±»å‹å®‰å…¨**ï¼šåœ¨å¤æ‚æ•°æ®ç»“æ„ä¸­ä¿æŒç±»å‹å®‰å…¨
5. **å“åº”å¼æ›´æ–°æœºåˆ¶**ï¼šæ·±åº¦ç›‘å¬å®ç°å›¾è¡¨è‡ªåŠ¨åˆ·æ–°
6. **Mock API è®¾è®¡**ï¼šæ¨¡æ‹ŸçœŸå®åœºæ™¯çš„æ•°æ®ç»“æ„å’Œå˜åŒ–

---

## æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

- `src/customComponents/chart/pieChart/pieChart.vue`
- `src/customComponents/chart/doughnutChart/doughnutChart.vue`
- `src/customComponents/chart/scatterChart/scatterChart.vue`

### ä¿®æ”¹æ–‡ä»¶

- `src/customComponents/registry.ts` - æ³¨å†Œä¸‰ä¸ªæ–°ç»„ä»¶
- `src/stores/component.ts` - æ·»åŠ é»˜è®¤é…ç½®å’Œ labelsPath å­—æ®µ
- `src/components/siderBar/properties/properties.ts` - å±æ€§é¢æ¿é…ç½®
- `src/components/componentBar.vue` - ç»„ä»¶é¢æ¿æ›´æ–°
- `test/mockServer.mjs` - Mock API æ‰©å±•

### ä»£ç ç»Ÿè®¡

- æ–°å¢ä»£ç ï¼šçº¦ 800 è¡Œ
- ä¿®æ”¹ä»£ç ï¼šçº¦ 200 è¡Œ
- æ–°å¢ Mock APIï¼š4 ä¸ªæ¥å£

---

## ä¸»é¢˜ 2ï¼šå›¾è¡¨ç»„ä»¶ä»£ç é‡æ„ - æŠ½ç¦»å…¬å…±å·¥å…·å‡½æ•°

### èƒŒæ™¯é—®é¢˜

æ‰€æœ‰å›¾è¡¨ç»„ä»¶ï¼ˆlineChartã€barChartã€stackedBarChartã€pieChartã€doughnutChartã€scatterChartï¼‰éƒ½åŒ…å«äº†é‡å¤çš„å·¥å…·å‡½æ•°ï¼š

- `getValueByPath` - è·¯å¾„è§£æ
- `parseDataInput` / `parseNumberInput` - è§£ææ•°å­—æ•°ç»„
- `parseXAxisInput` / `parseStringInput` - è§£æå­—ç¬¦ä¸²æ•°ç»„
- `parseLabelsInput` - è§£ææ ‡ç­¾æ•°ç»„
- `parse2DArrayInput` - è§£æäºŒç»´æ•°ç»„ï¼ˆæ•£ç‚¹å›¾ï¼‰
- æ•°æ®æå–é€»è¾‘ - ä»è¿œç¨‹æ•°æ®ä¸­æå–æ•°ç»„

è¿™äº›é‡å¤ä»£ç é€ æˆï¼š

1. **ä»£ç å†—ä½™**ï¼šç›¸åŒçš„å‡½æ•°åœ¨ 6 ä¸ªç»„ä»¶ä¸­é‡å¤å®šä¹‰
2. **ç»´æŠ¤å›°éš¾**ï¼šä¿®æ”¹é€»è¾‘éœ€è¦åŒæ­¥æ›´æ–°æ‰€æœ‰ç»„ä»¶
3. **ä½“ç§¯å¢å¤§**ï¼šæ¯ä¸ªç»„ä»¶éƒ½åŒ…å«å®Œæ•´çš„å·¥å…·å‡½æ•°ä»£ç 

### è§£å†³æ–¹æ¡ˆ

åˆ›å»ºå…¬å…±å·¥å…·æ¨¡å— `src/customComponents/chart/chartUtils.ts`ï¼Œå°†æ‰€æœ‰å›¾è¡¨ç»„ä»¶çš„å…±äº«å‡½æ•°æŠ½ç¦»åˆ°ç»Ÿä¸€ä½ç½®ã€‚

### å®ç°ç»†èŠ‚

#### 1. åˆ›å»ºå…¬å…±å·¥å…·æ–‡ä»¶

**æ–‡ä»¶ï¼š** `src/customComponents/chart/chartUtils.ts`

**æ ¸å¿ƒå‡½æ•°ï¼š**

```typescript
// è·¯å¾„è§£æ - æ”¯æŒç‚¹å·è·¯å¾„å’Œæ•°ç»„ç´¢å¼•
export function getValueByPath(obj: unknown, path: string): unknown

// æ•°æ®è§£æ - æ”¯æŒ JSON å’Œé€—å·åˆ†éš”ä¸¤ç§æ ¼å¼
export function parseNumberInput(input: string | undefined, defaultValue: number[]): number[]
export function parseStringInput(input: string | undefined, defaultValue: string[]): string[]
export function parse2DArrayInput(
  input: string | undefined,
  defaultValue: Array<[number, number]>,
): Array<[number, number]>

// æ•°æ®æå– - ä»è¿œç¨‹æ•°æ®ä¸­æå–ç‰¹å®šç±»å‹çš„æ•°ç»„
export function extractNumberArray(
  remoteData: unknown,
  dataPath: string | undefined,
): number[] | undefined
export function extractStringArray(
  remoteData: unknown,
  dataPath: string | undefined,
): string[] | undefined
export function extract2DArray(
  remoteData: unknown,
  dataPath: string | undefined,
): Array<[number, number]> | undefined
export function extractString(remoteData: unknown, dataPath: string | undefined): string | undefined
```

**å‡½æ•°ç‰¹æ€§ï¼š**

- å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- å®¹é”™å¤„ç†ï¼ˆè·¯å¾„ä¸å­˜åœ¨è¿”å› undefinedï¼‰
- æ”¯æŒ JSON æ ¼å¼å’Œé€—å·åˆ†éš”æ ¼å¼
- é»˜è®¤å€¼å‚æ•°æ”¯æŒ

#### 2. æ›´æ–°æ‰€æœ‰å›¾è¡¨ç»„ä»¶

**ä¿®æ”¹çš„ç»„ä»¶ï¼š**

1. `lineChart.vue` - æŠ˜çº¿å›¾
2. `barChart.vue` - æŸ±çŠ¶å›¾
3. `stackedBarChart.vue` - å †å æŸ±çŠ¶å›¾
4. `pieChart.vue` - é¥¼å›¾
5. `doughnutChart.vue` - ç¯å½¢å›¾
6. `scatterChart.vue` - æ•£ç‚¹å›¾

**ä¿®æ”¹å†…å®¹ï¼š**

**Before (æ¯ä¸ªç»„ä»¶)ï¼š**

```typescript
// æ¯ä¸ªç»„ä»¶éƒ½æœ‰è¿™äº›é‡å¤å‡½æ•°
function getValueByPath(obj: unknown, path: string): unknown {
  /* 20+ è¡Œä»£ç  */
}
function parseDataInput(input: string): number[] {
  /* 10+ è¡Œä»£ç  */
}
function parseXAxisInput(input: string): string[] {
  /* 10+ è¡Œä»£ç  */
}
// ... æ›´å¤šé‡å¤å‡½æ•°
```

**After (ä½¿ç”¨å…¬å…±å‡½æ•°)ï¼š**

```typescript
import {
  parseNumberInput,
  parseStringInput,
  extractNumberArray,
  extractStringArray,
  extractString,
} from '../chartUtils'

// æ•°æ®å¤„ç†é€»è¾‘ç®€åŒ–
const extractedData = extractNumberArray(remoteData.value, ds.dataPath)
if (extractedData) data = extractedData

const values = parseNumberInput(p.dataInput as string, defaultData)
```

#### 3. ä»£ç ç®€åŒ–ç¤ºä¾‹

**lineChart.vue - ç®€åŒ–å‰åå¯¹æ¯”ï¼š**

**Beforeï¼ˆçº¦ 60 è¡Œï¼‰ï¼š**

```typescript
function getValueByPath(obj: unknown, path: string): unknown {
  if (!path || !obj) return undefined
  try {
    const keys = path.replace(/\[(\d+)\]/g, '.$1').split('.')
    let result: unknown = obj
    for (const key of keys) {
      if (result === null || result === undefined) return undefined
      result = (result as Record<string, unknown>)[key]
    }
    return result
  } catch {
    return undefined
  }
}

// ... æ›´å¤šå‡½æ•°å®šä¹‰

if (ds?.enabled && remoteData.value) {
  if (ds.dataPath) {
    const extractedData = getValueByPath(remoteData.value, ds.dataPath)
    if (Array.isArray(extractedData)) {
      data = extractedData.map((v) => (typeof v === 'number' ? v : parseFloat(String(v))))
    }
  }
  // ... æ›´å¤šç±»ä¼¼ä»£ç 
}
```

**Afterï¼ˆçº¦ 10 è¡Œï¼‰ï¼š**

```typescript
import {
  extractNumberArray,
  extractStringArray,
  extractString,
  parseNumberInput,
  parseStringInput,
} from '../chartUtils'

if (ds?.enabled && remoteData.value) {
  const extractedData = extractNumberArray(remoteData.value, ds.dataPath)
  if (extractedData) data = extractedData

  const extractedXAxis = extractStringArray(remoteData.value, ds.xAxisPath)
  if (extractedXAxis) xAxisData = extractedXAxis

  const extractedName = extractString(remoteData.value, ds.seriesNamePath)
  if (extractedName) seriesName = extractedName
}
```

### é‡æ„æˆæœ

#### ä»£ç å‡å°‘ç»Ÿè®¡

| ç»„ä»¶            | ç®€åŒ–å‰       | ç®€åŒ–å       | å‡å°‘è¡Œæ•°    |
| --------------- | ------------ | ------------ | ----------- |
| lineChart       | ~280 è¡Œ      | ~230 è¡Œ      | ~50 è¡Œ      |
| barChart        | ~240 è¡Œ      | ~195 è¡Œ      | ~45 è¡Œ      |
| stackedBarChart | ~276 è¡Œ      | ~235 è¡Œ      | ~41 è¡Œ      |
| pieChart        | ~176 è¡Œ      | ~135 è¡Œ      | ~41 è¡Œ      |
| doughnutChart   | ~195 è¡Œ      | ~154 è¡Œ      | ~41 è¡Œ      |
| scatterChart    | ~172 è¡Œ      | ~140 è¡Œ      | ~32 è¡Œ      |
| **æ€»è®¡**        | **~1339 è¡Œ** | **~1089 è¡Œ** | **~250 è¡Œ** |

åŠ ä¸Šæ–°å¢çš„ `chartUtils.ts`ï¼ˆ180 è¡Œï¼‰ï¼Œå‡€å‡å°‘çº¦ 70 è¡Œä»£ç ã€‚

#### ä»£ç è´¨é‡æå‡

1. **å¯ç»´æŠ¤æ€§**ï¼š
   - å·¥å…·å‡½æ•°åªéœ€åœ¨ä¸€ä¸ªåœ°æ–¹ä¿®æ”¹
   - å‡å°‘äº† bug å‡ºç°çš„æœºä¼š
   - ç»Ÿä¸€çš„å‡½æ•°å®ç°ä¿è¯ä¸€è‡´æ€§

2. **å¯è¯»æ€§**ï¼š
   - ç»„ä»¶ä»£ç æ›´ç®€æ´ï¼Œä¸“æ³¨äºä¸šåŠ¡é€»è¾‘
   - å‡½æ•°åç§°æ¸…æ™°è¡¨è¾¾æ„å›¾
   - å‡å°‘äº†ä»£ç åµŒå¥—å±‚çº§

3. **å¯å¤ç”¨æ€§**ï¼š
   - æ–°å¢å›¾è¡¨ç»„ä»¶å¯ç›´æ¥ä½¿ç”¨å·¥å…·å‡½æ•°
   - å·¥å…·å‡½æ•°å¯ç”¨äºå…¶ä»–éœ€è¦æ•°æ®å¤„ç†çš„ç»„ä»¶
   - å®Œæ•´çš„ TypeScript ç±»å‹æ”¯æŒ

4. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å‡å°‘äº†é‡å¤ä»£ç çš„æ‰“åŒ…ä½“ç§¯
   - å·¥å…·å‡½æ•°å¯è¢« tree-shaking ä¼˜åŒ–
   - ç»Ÿä¸€çš„å®ç°æ–¹å¼ä¾¿äºåç»­ä¼˜åŒ–

### æŠ€æœ¯è¦ç‚¹

#### 1. å‡½æ•°è®¾è®¡åŸåˆ™

```typescript
// âœ… è‰¯å¥½çš„è®¾è®¡
export function parseNumberInput(
  input: string | undefined,
  defaultValue: number[] = [], // æä¾›é»˜è®¤å€¼
): number[] {
  if (!input) return defaultValue
  // æ”¯æŒå¤šç§æ ¼å¼
  try {
    const parsed = JSON.parse(input)
    if (Array.isArray(parsed)) {
      return parsed
        .map((v) => (typeof v === 'number' ? v : parseFloat(String(v))))
        .filter((v) => !isNaN(v))
    }
  } catch {}

  return input
    .split(',')
    .map((v) => parseFloat(v.trim()))
    .filter((v) => !isNaN(v))
}
```

**è®¾è®¡è€ƒè™‘ï¼š**

- å‚æ•°é»˜è®¤å€¼é¿å…ç©ºå€¼é—®é¢˜
- æ”¯æŒå¤šç§è¾“å…¥æ ¼å¼ï¼ˆJSONã€é€—å·åˆ†éš”ï¼‰
- ç±»å‹è½¬æ¢å’Œæ•°æ®æ¸…æ´—
- å®¹é”™å¤„ç†

#### 2. ç±»å‹å®‰å…¨

```typescript
// å®Œæ•´çš„ç±»å‹å®šä¹‰
export function extract2DArray(
  remoteData: unknown,
  dataPath: string | undefined,
): Array<[number, number]> | undefined {
  // ç±»å‹æ£€æŸ¥å’Œè½¬æ¢
  if (Array.isArray(extractedData) && extractedData.length > 0 && Array.isArray(extractedData[0])) {
    return extractedData.map((item) => {
      if (Array.isArray(item) && item.length >= 2) {
        return [
          typeof item[0] === 'number' ? item[0] : parseFloat(String(item[0])),
          typeof item[1] === 'number' ? item[1] : parseFloat(String(item[1])),
        ] as [number, number]
      }
      return [0, 0] as [number, number]
    })
  }
  return undefined
}
```

#### 3. è·¯å¾„è§£æå¢å¼º

```typescript
export function getValueByPath(obj: unknown, path: string): unknown {
  if (!path || !obj) return undefined
  try {
    // æ”¯æŒæ•°ç»„ç´¢å¼•ï¼šdata.items[0].name -> data.items.0.name
    const keys = path.replace(/\[(\d+)\]/g, '.$1').split('.')
    let result: unknown = obj
    for (const key of keys) {
      if (result === null || result === undefined) return undefined
      result = (result as Record<string, unknown>)[key]
    }
    return result
  } catch {
    return undefined
  }
}
```

### åç»­ä¼˜åŒ–å»ºè®®

- [ ] æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–æ‰€æœ‰å·¥å…·å‡½æ•°
- [ ] æ”¯æŒæ›´å¤šæ•°æ®æ ¼å¼ï¼ˆXMLã€YAMLï¼‰
- [ ] æ·»åŠ æ•°æ®è½¬æ¢å‡½æ•°ï¼ˆå•ä½æ¢ç®—ã€æ ¼å¼åŒ–ï¼‰
- [ ] æä¾›æ•°æ®éªŒè¯å‡½æ•°ï¼ˆèŒƒå›´æ£€æŸ¥ã€ç±»å‹æ£€æŸ¥ï¼‰
- [ ] ç¼“å­˜è·¯å¾„è§£æç»“æœä¼˜åŒ–æ€§èƒ½

### æŠ€æœ¯æ”¶è·

1. **ä»£ç é‡æ„æœ€ä½³å®è·µ**ï¼šè¯†åˆ«é‡å¤ä»£ç å¹¶æŠ½ç¦»å…¬å…±å‡½æ•°
2. **æ¨¡å—åŒ–è®¾è®¡**ï¼šåˆ›å»ºç‹¬ç«‹çš„å·¥å…·æ¨¡å—æé«˜ä»£ç ç»„ç»‡æ€§
3. **TypeScript æ³›å‹åº”ç”¨**ï¼šè®¾è®¡é€šç”¨çš„ç±»å‹å®‰å…¨å‡½æ•°
4. **DRY åŸåˆ™å®è·µ**ï¼šDon't Repeat Yourself åœ¨å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨
5. **æ¸è¿›å¼é‡æ„**ï¼šåœ¨ä¸å½±å“åŠŸèƒ½çš„å‰æä¸‹é€æ­¥ä¼˜åŒ–ä»£ç ç»“æ„

---

## ä»Šæ—¥æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

- `src/customComponents/chart/chartUtils.ts` - å›¾è¡¨å…¬å…±å·¥å…·å‡½æ•°ï¼ˆ180 è¡Œï¼‰
- `src/customComponents/chart/pieChart/pieChart.vue`
- `src/customComponents/chart/doughnutChart/doughnutChart.vue`
- `src/customComponents/chart/scatterChart/scatterChart.vue`

### ä¿®æ”¹æ–‡ä»¶

- `src/customComponents/chart/lineChart/lineChart.vue` - ä½¿ç”¨å…¬å…±å‡½æ•°ï¼Œå‡å°‘ 50 è¡Œ
- `src/customComponents/chart/barChart/barChart.vue` - ä½¿ç”¨å…¬å…±å‡½æ•°ï¼Œå‡å°‘ 45 è¡Œ
- `src/customComponents/chart/stackedBarChart/stackedBarChart.vue` - ä½¿ç”¨å…¬å…±å‡½æ•°ï¼Œå‡å°‘ 41 è¡Œ
- `src/customComponents/chart/pieChart/pieChart.vue` - ä½¿ç”¨å…¬å…±å‡½æ•°ï¼Œå‡å°‘ 41 è¡Œ
- `src/customComponents/chart/doughnutChart/doughnutChart.vue` - ä½¿ç”¨å…¬å…±å‡½æ•°ï¼Œå‡å°‘ 41 è¡Œ
- `src/customComponents/chart/scatterChart/scatterChart.vue` - ä½¿ç”¨å…¬å…±å‡½æ•°ï¼Œå‡å°‘ 32 è¡Œ
- `src/customComponents/registry.ts` - æ³¨å†Œä¸‰ä¸ªæ–°ç»„ä»¶
- `src/stores/component.ts` - æ·»åŠ é»˜è®¤é…ç½®å’Œ labelsPath å­—æ®µ
- `src/components/siderBar/properties/properties.ts` - å±æ€§é¢æ¿é…ç½®
- `src/components/componentBar.vue` - ç»„ä»¶é¢æ¿æ›´æ–°
- `test/mockServer.mjs` - Mock API æ‰©å±•

### ä»£ç ç»Ÿè®¡ï¼ˆä»Šæ—¥æ€»è®¡ï¼‰

- æ–°å¢ä»£ç ï¼šçº¦ 980 è¡Œï¼ˆå›¾è¡¨ç»„ä»¶ 800 è¡Œ + å·¥å…·å‡½æ•° 180 è¡Œï¼‰
- é‡æ„å‡å°‘ï¼šçº¦ 250 è¡Œï¼ˆ6 ä¸ªç»„ä»¶å»é‡ï¼‰
- å‡€å¢åŠ ï¼šçº¦ 730 è¡Œ
- æ–°å¢ Mock APIï¼š4 ä¸ªæ¥å£
- ä»£ç è´¨é‡ï¼šæå‡å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§
