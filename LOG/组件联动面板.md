# 组件联动面板功能说明

## 概述

组件联动面板是一个综合性的组件关系管理工具，位于侧边栏的"联动"标签页中。它提供了组件之间的父子关系、事件交互、数据联动和组合关系的完整管理功能。

## 主要功能

### 1. 父子关系 (Hierarchy)

管理组件的层级结构，实现容器组件和子组件的嵌套关系。

#### 功能特点：

- **当前组件信息**：显示当前选中组件的类型和 ID
- **父组件管理**：
  - 查看当前组件的父组件
  - 从下拉列表中选择新的父组件
  - 移除父子关系
  - 点击父组件卡片可快速切换选择
- **子组件管理**：
  - 显示所有子组件列表（包含数量统计）
  - 通过对话框添加新的子组件
  - 单独移除某个子组件
  - 点击子组件卡片可快速切换选择

#### 使用场景：

- Badge 组件包含图标或文本作为子组件
- Group 组件包含多个组件进行统一管理
- Row/Col 布局组件包含内容组件
- 任何需要容器-内容关系的场景

#### 实现原理：

```typescript
// 父子关系通过两个字段维护：
component.groupId // 子组件记录父组件ID
component.children // 父组件记录子组件ID数组
```

### 2. 事件交互 (Events)

配置组件响应用户交互（点击、悬停）时触发的动作。

#### 点击事件动作类型：

- **显示/隐藏** (toggle-visibility)：切换目标组件的可见性
- **跳转到组件** (scroll-to)：滚动画布到目标组件位置
- **触发数据更新** (refresh-data)：刷新当前组件的数据源
- **执行动画** (play-animation)：触发目标组件的动画效果

#### 悬停事件动作类型：

- **显示提示** (show-tooltip)：显示提示信息
- **高亮组件** (highlight)：高亮显示目标组件
- **显示详情** (show-detail)：展开目标组件的详细信息

#### 使用场景：

- KPI 组件点击后刷新实时数据
- Badge 组件点击后显示详细图表
- 按钮组件点击后显示/隐藏某个面板
- 图表悬停时高亮相关的 KPI 组件

#### 配置示例：

```typescript
// 点击 Badge 后刷新数据并显示图表
clickActions: [{ type: 'refresh-data' }, { type: 'toggle-visibility', targetId: 'chart-123' }]
```

### 3. 数据联动 (Data Binding)

建立组件之间的数据绑定关系，实现数据的自动同步。

#### 功能特点：

- **数据源组件**：选择提供数据的组件
- **源字段路径**：指定源组件中的数据路径（支持嵌套路径）
- **目标字段路径**：指定当前组件接收数据的字段路径
- **多重绑定**：可以添加多个数据绑定关系

#### 使用场景：

- 图表组件的数据同步到 KPI 组件
- 多个 KPI 组件显示同一数据源的不同字段
- 实现主从视图：选择主图表的某项后，从组件显示详情
- 级联更新：一个组件变化触发多个组件更新

#### 路径语法：

```typescript
// 示例数据结构
{
  data: {
    metrics: {
      sales: 12345,
      growth: 15.6
    }
  }
}

// 绑定配置
{
  sourceId: 'chart-001',
  sourcePath: 'data.metrics.sales',  // 点语法访问嵌套字段
  targetPath: 'value'                 // 目标组件的值字段
}
```

### 4. 组合关系 (Grouping)

查看和管理组件所属的组合（Group）。

#### 功能特点：

- 显示当前组件所属的组合
- 点击组合卡片快速切换到组合组件
- 从组合中移除当前组件

#### 使用场景：

- 将多个组件打包成组合进行整体操作
- 组合组件的统一移动、复制、删除
- 组合组件的样式继承和批量设置

#### 与父子关系的区别：

- **父子关系**：用于容器组件，子组件渲染在父组件内部
- **组合关系**：用于逻辑分组，组件位置独立，仅建立关联

## 用户界面

### 布局结构

```
侧边栏
└── 联动标签页
    ├── 父子关系（可折叠）
    │   ├── 当前组件信息
    │   ├── 父组件设置
    │   └── 子组件列表
    ├── 事件交互（可折叠）
    │   ├── 点击事件配置
    │   └── 悬停事件配置
    ├── 数据联动（可折叠）
    │   └── 数据绑定列表
    └── 组合关系（可折叠）
        └── 所属组合信息
```

### 交互特点

- **卡片式展示**：组件以卡片形式展示，点击可快速切换选择
- **空状态提示**：无数据时显示友好的空状态图标和说明
- **即时反馈**：所有操作立即生效并更新界面
- **防误操作**：删除/移除操作有明确的按钮标识

## 技术实现

### 数据结构

```typescript
// 组件接口
interface component {
  id: string
  type: string
  groupId?: string // 父组件ID（用于容器关系）
  children?: string[] // 子组件ID列表（用于容器关系）
  // ... 其他属性
}

// 事件动作接口
interface Action {
  type: string // 动作类型
  targetId?: string // 目标组件ID
}

// 数据绑定接口
interface DataBinding {
  sourceId: string // 数据源组件ID
  sourcePath: string // 源字段路径
  targetPath: string // 目标字段路径
}
```

### 核心逻辑

```typescript
// 设置父子关系
function setParent(parentId: string) {
  // 1. 初始化父组件的 children 数组
  // 2. 添加当前组件到父组件的 children
  // 3. 设置当前组件的 groupId
}

// 添加子组件
function addChild() {
  // 1. 初始化当前组件的 children 数组
  // 2. 添加子组件ID到 children
  // 3. 设置子组件的 groupId
}

// 选择组件
function selectComponentById(id: string) {
  // 切换 componentStore 中的 selectComponent
  // 触发界面更新
}
```

### 组件过滤

```typescript
// 可用的父组件：排除自己和自己的子组件
const availableParents = computed(() => {
  return components.value.filter(
    (c) => c.id !== currentId && !childrenIds.includes(c.id) && c.type !== 'Text',
  )
})

// 可用的子组件：排除自己、父组件和已有父组件的组件
const availableChildren = computed(() => {
  return components.value.filter((c) => c.id !== currentId && c.id !== parentId && !c.groupId)
})
```

## 扩展功能规划

### 后续可添加的功能

1. **动画联动**
   - 组件动画的序列编排
   - 连锁动画效果
   - 动画时间轴管理

2. **样式联动**
   - 样式变量共享
   - 主题样式继承
   - 响应式样式同步

3. **状态联动**
   - 组件状态（激活/禁用）同步
   - 加载状态传播
   - 错误状态关联

4. **条件联动**
   - 基于数据条件的显示/隐藏
   - 阈值触发的样式变化
   - 规则引擎支持

## 使用建议

### 最佳实践

1. **父子关系**：
   - 优先用于需要视觉嵌套的场景
   - 确保父组件支持子组件渲染（如 Badge、Group、Row、Col）
   - 避免过深的嵌套层级（建议不超过 3 层）

2. **事件交互**：
   - 为用户常用操作配置快捷交互
   - 避免过多的事件绑定影响性能
   - 提供清晰的视觉反馈

3. **数据联动**：
   - 规划好数据流向，避免循环依赖
   - 使用统一的字段路径命名规范
   - 考虑数据更新的性能影响

4. **组合关系**：
   - 用于逻辑相关但视觉独立的组件
   - 便于批量管理和复用
   - 保持组合的语义清晰

### 性能优化

- 使用计算属性缓存组件过滤结果
- 避免频繁的父子关系调整
- 合理使用数据联动的更新频率
- 大量组件时考虑虚拟列表优化

## 总结

组件联动面板提供了完整的组件关系管理能力，是构建复杂交互式可视化应用的基础工具。通过统一的界面管理父子关系、事件交互、数据联动和组合关系，大大提升了开发效率和用户体验。

**关键特性**：

- 🔗 灵活的父子关系管理
- ⚡ 丰富的事件交互配置
- 🔄 强大的数据联动能力
- 📦 便捷的组合关系管理
- 🎯 直观的卡片式交互界面
- 🚀 为容器和布局组件提供统一的管理方案
