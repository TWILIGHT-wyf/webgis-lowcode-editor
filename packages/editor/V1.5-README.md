# Editor V1.5 æ¶æ„é‡æ„è¯´æ˜

## ğŸ¯ é‡æ„ç›®æ ‡

å°† Editor åŒ…ä»æ‰å¹³ç»“æ„å‡çº§ä¸º**æ ‘å½¢æ¶æ„ + ç‹¬ç«‹æ¸²æŸ“å¼•æ“**ï¼Œå®ç°ï¼š

- é€’å½’æ ‘å½¢ç»„ä»¶ç»“æ„
- ç‹¬ç«‹çš„ Renderer åŒ…
- æ¸…æ™°çš„èŒè´£åˆ’åˆ†
- æ›´å¥½çš„å¯ç»´æŠ¤æ€§

## ğŸ“ æ–°ç›®å½•ç»“æ„

```
packages/editor/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Canvas/              # ç”»å¸ƒåŒºåŸŸï¼ˆV1.5ï¼‰
â”‚   â”‚   â””â”€â”€ CanvasBoard.vue
â”‚   â”œâ”€â”€ MaterialPanel/       # ç‰©æ–™é¢æ¿
â”‚   â”‚   â””â”€â”€ MaterialPanel.vue
â”‚   â”œâ”€â”€ SetterPanel/         # å±æ€§è®¾ç½®å™¨
â”‚   â”‚   â””â”€â”€ SetterPanel.vue
â”‚   â””â”€â”€ Layout/              # å¸ƒå±€ç»„ä»¶ï¼ˆé¢„ç•™ï¼‰
â”œâ”€â”€ stores/
â”‚   â”œâ”€â”€ component.ts         # æ—§ç‰ˆ Storeï¼ˆå…¼å®¹ï¼‰
â”‚   â””â”€â”€ componentV2.ts       # V1.5 æ ‘å½¢ Store âœ¨
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ editor.vue           # æ—§ç‰ˆç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ EditorV2.vue         # V1.5 æ–°ç¼–è¾‘å™¨ âœ¨
â”‚   â””â”€â”€ Preview.vue          # V1.5 é¢„è§ˆé¡µ âœ¨
â””â”€â”€ types/                   # ç±»å‹å®šä¹‰ï¼ˆé‡å‘½åè‡ª typeï¼‰
```

## ğŸ”„ æ ¸å¿ƒå˜æ›´

### 1. Store é‡æ„ï¼ˆcomponentV2.tsï¼‰

**æ—§æ¶æ„ï¼ˆæ‰å¹³æ•°ç»„ï¼‰**

```typescript
const componentStore = ref<Component[]>([]) // æ‰å¹³æ•°ç»„
```

**æ–°æ¶æ„ï¼ˆæ ‘å½¢ç»“æ„ï¼‰**

```typescript
const project = ref<ProjectSchema>({
  pages: [{
    children: {              // é€’å½’æ ‘
      id: 'root',
      children: [...]        // æ— é™åµŒå¥—
    }
  }]
})
```

### 2. æ¸²æŸ“æ–¹å¼å˜æ›´

**æ—§æ–¹å¼ï¼šShape + ç»å¯¹å®šä½**

```vue
<Shape v-for="com in components" :key="com.id" />
```

**æ–°æ–¹å¼ï¼šRecursiveRenderer é€’å½’**

```vue
<RecursiveRenderer :node="currentTree" />
```

### 3. å…³é”® API

#### Store API

```typescript
// è·å–å½“å‰æ ‘
const { currentTree } = storeToRefs(useComponentStoreV2())

// æ·»åŠ ç»„ä»¶
addComponent('Button', parentId, props, style)

// æ›´æ–°å±æ€§
updateComponentProps(id, { text: 'Hello' })

// åˆ é™¤ç»„ä»¶
removeComponent(id)
```

#### Renderer Props

```typescript
interface RecursiveRendererProps {
  node: NodeSchema // èŠ‚ç‚¹æ•°æ®ï¼ˆè‡ªåŠ¨é€’å½’æ¸²æŸ“ childrenï¼‰
}
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### è®¿é—® V1.5 ç¼–è¾‘å™¨

1. **å¼€å‘ç¯å¢ƒ**

   ```bash
   pnpm dev
   ```

2. **è®¿é—®æµ‹è¯•é¡µé¢**
   - æµ‹è¯•å…¥å£: http://localhost:5173/v15-test.html
   - ç¼–è¾‘å™¨: http://localhost:5173/editor-v2
   - é¢„è§ˆ: http://localhost:5173/preview

### ä½¿ç”¨æµç¨‹

1. **æ‹–æ‹½ç‰©æ–™** - ä»å·¦ä¾§ç‰©æ–™é¢æ¿æ‹–æ‹½ç»„ä»¶åˆ°ç”»å¸ƒ
2. **é€‰ä¸­ç¼–è¾‘** - ç‚¹å‡»ç”»å¸ƒä¸­çš„ç»„ä»¶è¿›è¡Œé€‰ä¸­
3. **å±æ€§è®¾ç½®** - åœ¨å³ä¾§é¢æ¿ä¿®æ”¹ç»„ä»¶å±æ€§å’Œæ ·å¼
4. **é¢„è§ˆæ•ˆæœ** - ç‚¹å‡»é¡¶éƒ¨"é¢„è§ˆ"æŒ‰é’®æŸ¥çœ‹æœ€ç»ˆæ•ˆæœ

## ğŸ“¦ ä¾èµ–å…³ç³»

```
@lowcode/editor (æœ¬åŒ…)
  â”œâ”€ @lowcode/core          # åè®®å±‚
  â”œâ”€ @lowcode/renderer      # æ¸²æŸ“å¼•æ“ âœ¨
  â”œâ”€ @lowcode/materials     # ç‰©æ–™åº“
  â””â”€ @lowcode/ui            # ç»„ä»¶åº“
```

## ğŸ”§ å·¥å…·å‡½æ•°

### Core æ–°å¢å·¥å…·

```typescript
// ç”Ÿæˆå”¯ä¸€ID
import { generateId } from '@lowcode/core'
const id = generateId('Button') // Button_1234567890_abc123

// æŸ¥æ‰¾èŠ‚ç‚¹
import { findNodeById } from '@lowcode/core'
const node = findNodeById(tree, 'Button_xxx')

// éå†æ ‘
import { traverse } from '@lowcode/core'
traverse(tree, (node) => {
  console.log(node.id)
})
```

## ğŸ¨ ç»„ä»¶å¼€å‘è§„èŒƒ

### ç‰©æ–™ç»„ä»¶è¦æ±‚

1. **å¿…é¡»æ¥æ”¶ data-id**

   ```vue
   <div :data-id="$attrs['data-id']">
     <!-- å†…å®¹ -->
   </div>
   ```

2. **å®¹å™¨ç»„ä»¶éœ€è¦æ”¯æŒ children**
   ```vue
   <div :data-id="$attrs['data-id']">
     <slot />  <!-- æ¸²æŸ“å­ç»„ä»¶ -->
   </div>
   ```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å…¼å®¹æ€§**
   - æ—§ç‰ˆç¼–è¾‘å™¨ï¼ˆ/editor/:idï¼‰ä»ç„¶å¯ç”¨
   - V1.5 æ˜¯ç‹¬ç«‹çš„æ–°å®ç°ï¼Œä¸å½±å“æ—§åŠŸèƒ½

2. **æ•°æ®è¿ç§»**
   - æ—§ç‰ˆæ•°æ®ç»“æ„ä¸å…¼å®¹æ–°ç‰ˆ
   - éœ€è¦è¿ç§»è„šæœ¬ï¼ˆTODOï¼‰

3. **æ€§èƒ½ä¼˜åŒ–**
   - RecursiveRenderer ä½¿ç”¨ Vue 3 çš„å“åº”å¼ç³»ç»Ÿ
   - å¤§è§„æ¨¡æ•°æ®å»ºè®®ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨

## ğŸ“ TODO

- [ ] æ”¯æŒæ‹–æ‹½æ’åº
- [ ] æ”¯æŒç»„ä»¶åµŒå¥—ï¼ˆè®¡ç®—è½ç‚¹ä½ç½®ï¼‰
- [ ] æ’¤é”€/é‡åšåŠŸèƒ½
- [ ] æ•°æ®æºç»‘å®š
- [ ] äº‹ä»¶æµç¼–æ’
- [ ] ä»£ç ç”Ÿæˆå™¨é›†æˆ

## ğŸ¤ è´¡çŒ®æŒ‡å—

ä¿®æ”¹æµç¨‹ï¼š

1. ä¿®æ”¹ componentV2.tsï¼ˆçŠ¶æ€é€»è¾‘ï¼‰
2. ä¿®æ”¹å¯¹åº” Vue ç»„ä»¶ï¼ˆUI é€»è¾‘ï¼‰
3. æµ‹è¯• /editor-v2 å’Œ /preview
4. æäº¤ PR

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Core åè®®æ–‡æ¡£](../core/README.md)
- [Renderer ä½¿ç”¨æŒ‡å—](../renderer/README.md)
- [Materials å¼€å‘æŒ‡å—](../materials/README.md)
